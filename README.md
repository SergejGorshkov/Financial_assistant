# Приложение для анализа транзакций

Проект написан на Python. В нем реализуются функции анализа транзакций, которые находятся в Excel-файле. 
Приложение генерирует JSON-данные для веб-страниц, а также предоставляет другие сервисы (см. раздел "Структура проекта").

## Структура проекта.

Проект состоит из следующих модулей:
1. main.py
   
    Главный модуль. Объединяет логику всего проекта, из него происходит запуск всех функций.
    
2. views.py

    Содержит функцию main_info, объединяющую логику веб-страницы "Главная".
    Принимает на вход строку с датой и временем в формате YYYY-MM-DD HH:MM:SS (напр. '2021-04-10 20:30:00').
    Возвращает JSON-ответ со следующими данными: 1) приветствие с указанием текущего времени суток;
    2) информацию по каждой карте (последние 4 цифры карты, общая сумма расходов, кешбэк (1 рубль на каждые
    100 рублей); 3) топ-5 транзакций по сумме платежа; 4) курс валют (по умолчанию относительно "RUB");
    5) стоимость акций (End-of-Day Data) из S&P500.
   
3. utils.py

   Содержит функции, обеспечивающие работу функции main_info и веб-страницы "Главная":
   * Функция `get_date_range`.
    Для получения периода времени для выборки транзакций (для ее последующего анализа).
    Принимает строку с датой и временем в формате YYYY-MM-DD HH:MM:SS, обозначающей конечную границу выборки
    (начало выборки - первый день заданного месяца).
    Возвращает начальную и конечную даты в виде строки для последующей выборки транзакций.
   * Функция `read_data_file`.
   Для получения объекта DataFrame с транзакциями из файла для последующего анализа. 
   Считывает данные из файла.
   Возвращает датафрейм с транзакциями, отсортированный по убыванию даты.
   * Функция `get_slice_of_data`.
   Для получения выборки транзакций из Excel-файла для последующего анализа.
   Принимает даты начала и конца выборки в виде объектов datetime.
   Возвращает датафрейм с транзакциями за указанный период, отсортированный по возрастанию даты.
   * Функция `get_time_for_greeting`.
   Возвращает приветствие в формате «Доброе утро» / «Добрый день» / «Добрый вечер» / «Доброй ночи»
   в зависимости от текущего времени (на момент запуска программы).
   * Функция `get_summary_card_data`.
   Для получения сводных данных о расходах по всем картам клиента (в т.ч. отдельно для всех неуказанных карт).
   Принимает данные о транзакциях в формате DataFrame.
   Возвращает список словарей в формате:
   
    `[{
      "last_digits": "5814",
      "total_spent": 1262.00,
      "cashback": 12.62
    }]`
    * Функция `top_5_transactions_by_sum`.
    Для получения ТОП-5 транзакций по величине суммы.
    Принимает данные о транзакциях в формате DataFrame.
    Возвращает список словарей в формате:
    `[{
      "date": "21.12.2021",
      "amount": 1198.23,
      "category": "Переводы",
      "description": "Перевод Кредитная карта."
    }]`
    * Функция `actual_currencies`.
    Для получения актуальных курсов валют (тикеры загружаются из файла `user_settings.json`).
    Принимает строку с тикером базовой валюты, относительно которой рассчитываются курсы валют из файла
    `user_settings.json` (по умолчанию - "RUB").
    Возвращает список словарей в формате:
     
    `[{
      "currency": "USD",
      "rate": 73.21
    }]`
    или пустой список, если не удалось получить курс валют.
    * Функция `actual_stocks`.
    Для получения актуальной стоимости акций (из файла `user_settings.json`).
    Не имеет параметров.
    Возвращает список словарей в формате:
     
    `[{
      "stock": "AAPL",
      "price": 150.12
    }]`
    или пустой список, если не удалось получить курс акций.

4. services.py

    Содержит функцию `get_high_cashback_categories`из раздела "Сервисы", анализирующая, какие категории были наиболее
    выгодными в заданном месяце для выбора в качестве категорий повышенного кешбэка.
    Принимает на вход данные для анализа в формате DataFrame, год и месяц в формате str.
    Возвращает JSON-ответ с анализом, сколько на каждой категории расходов можно заработать кешбэка в указанном
    месяце года.

5. reports.py

    Содержит функцию `spending_by_category`, выбирающую из данных о транзакциях траты по заданной категории.
    Принимает данные о транзакциях в формате DataFrame, название категории в формате str, опционально дату
    в формате str (ДД.ММ.ГГГГ). Если дата не передана, то берется текущая дата.
    Возвращает траты по заданной категории за последние три месяца (от переданной или текущей даты) в формате DataFrame.

## Проверка кода.

В проекте выполнены проверки линтерами:
- Flake8: для проверки стиля кода;
- mypy: для статической типизации;
- black: для автоматического форматирования кода;
- isort: для сортировки импортов.

## Установка.

1. Клонируйте репозиторий:
```
git clone https://github.com/SergejGorshkov/Financial_assistant.git
```
2. Установите зависимости:
```
pip install -r requirements.txt
```
3. Для хранения конфиденциальных данных (ключей API, паролей и т.д.) создайте файл 
'.env' из копии файла '.env.example', поместите его в корневую директорию проекта
и замените значения переменных реальными данными. 
Обязательно добавьте файл '.env' в .gitignore.

## Тестирование.

Проект покрыт тестами `pytest` на 83%. 
Для их запуска и формирования отчета выполните команду: 
```
pytest --cov=src --cov-report=html
```
Отчет будет сгенерирован в папке htmlcov и храниться в файле с названием 
index.html.
